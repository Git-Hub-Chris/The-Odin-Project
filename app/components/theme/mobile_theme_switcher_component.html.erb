<div data-controller="visibility" data-action="visibility:click:outside->visibility#off" class="flex items-center space-x-2 w-full">
  <div class="p-2 flex cursor-pointer items-center rounded-lg button--dark" data-action="click->visibility#toggle" data-testid="sort-select dark:ring-inset">
    <span class="text-white text-base font-medium dark:text-gray-300">
      <%= inline_svg_tag "icons/#{icon}.svg", aria: true, title: 'Select icon' %>
    </span>
    <button type="button" class="focus:outline-none text-white px-4 font-medium dark:text-gray-300" aria-haspopup="listbox" aria-expanded="true" aria-labelledby="listbox-label">
      <%= text %>
    </button>
    <%= inline_svg_tag 'icons/chevron-down.svg', class: 'w-4 h-4 text-white group-hover:text-gray-500 dark:text-gray-200 dark:group-hover:text-gray-200', aria: true, title: 'Select icon' %>
  </div>

   <ul
    data-visibility-target="content"
    data-transition-enter=""
    data-transition-enter-start=""
    data-transition-enter-end=""
    data-transition-leave="transition ease-in duration-100"
    data-transition-leave-start="opacity-100"
    data-transition-leave-end="opacity-0"
    class="absolute hidden z-10 mt-1 max-h-60 w-full min-w-max rounded-md bg-white dark:bg-gray-700 py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm" tabindex="-1" role="listbox" aria-labelledby="listbox-label" aria-activedescendant="listbox-option-3">

      <% options.each do |option| %>
        <li class="text-gray-900 dark:text-gray-200 relative cursor-default select-none py-2 pl-8 pr-4" id="listbox-option-0" role="option">
          <%= link_to themes_path(theme: option.fetch(:value)), tabindex: '-1', data: { turbo_method: :put, controller: 'theme-switcher' } do %>
            <span class="font-normal text-sm block <%= 'font-semibold' if selected?(option) %>"><%= option.fetch(:label) %> </span>
          <% end %>
          <% if selected[:value] == option.fetch(:value) %>
            <span class="text-gray-800 dark:text-gray-300 absolute inset-y-0 left-0 flex items-center pl-2">
              <%= inline_svg_tag 'icons/check.svg', class: 'h-4 w-4', aria: true, title: 'Selected option' %>
            </span>
          <% end %>
        </li>
      <% end %>

    </ul>
  </div>
</div>
