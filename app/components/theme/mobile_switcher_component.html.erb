<div data-controller="visibility" data-action="visibility:click:outside->visibility#off" class="flex items-center space-x-2 w-full">
  <button type="button" data-action="click->visibility#toggle" data-test-id="sort-select" class="relative w-full cursor-default rounded-md bg-white dark:bg-gray-700 py-1.5 pl-3 pr-10 text-left text-gray-900 dark:text-gray-200 shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-600 dark:focus:ring-gray-500 sm:text-sm sm:leading-6" aria-haspopup="listbox" aria-expanded="true" aria-labelledby="listbox-label">
    <span class="text-gray-600 hover:bg-gray-50 hover:text-gray-900 px-1 py-1 text-base font-medium dark:text-gray-300 dark:hover:text-gray-200 dark:hover:bg-gray-700/60 "><%= current_theme.name.capitalize %> mode</span>
    <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
      <%= inline_svg_tag 'icons/arrows-up-down.svg', class: 'h-5 w-5 text-gray-400 dark:text-gray-300', aria: true, title: 'Select Theme' %>
    </span>
  </button>

  <ul
    data-visibility-target="content"
    data-transition-enter=""
    data-transition-enter-start=""
    data-transition-enter-end=""
    data-transition-leave="transition ease-in duration-100"
    data-transition-leave-start="opacity-100"
    data-transition-leave-end="opacity-0"
    class="absolute hidden z-10 mt-1 max-h-60 w-full min-w-max rounded-md bg-white dark:bg-gray-700 py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm" tabindex="-1" role="listbox" aria-labelledby="listbox-label" aria-activedescendant="listbox-option-3">

    <ul data-controller="theme-switcher" data-theme-switcher-current-theme-value="<%= current_theme.to_s %>" data-theme-switcher-url-value="<%= themes_path(format: :turbo_stream) %>">
      <% Users::Theme.default_themes.each do |theme| %>
        <li class="text-gray-700 dark:text-gray-300 group flex items-center px-3 py-2 text-sm cursor-pointer" data-action="click->theme-switcher#handleThemeChangeRequest" data-theme="<%= theme.name %>">
          <%= inline_svg_tag "icons/#{theme.icon}.svg", class: 'mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500 dark:text-gray-300 dark:group-hover:text-gray-400', title: "#{theme.name} mode option", aria: true %>
          <%= "#{theme.name.capitalize} mode" %>
        </li>
      <% end %>
    </ul>
  </ul>
  </div>
</div>
